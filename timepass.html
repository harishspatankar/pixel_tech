<html lang="en">
<head>
  <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>WebSockets</title>
</head>
<body>
  <p id = "demo"></p>
  <script>

  var heading_ids = [];
  var sockets = [];
  function createHeaders(){
    var headings = "";
    for(let i = 1 ; i < 257 ; i++){
      headings = headings + "<h3 id=heading_"+i+">Hello</h3>"
    }
    document.getElementById("demo").innerHTML = headings;
  }

  function setHeadingIds(){
    for(let i = 1 ; i < 257 ; i++){
      heading_ids[i] = document.getElementById("heading_"+i);
      console.log(heading_ids[i]);
      sockets[i] = new WebSocket('ws://localhost:8081');
      sockets[i].onopen = function() {
        console.log('Opened connection ');

        // send data to the server
        var json = JSON.stringify({ message: 'Hello' });
        sockets[i].send(json);
      }

      // When data is received
      sockets[i].onmessage = function(event) {
        console.log(JSON.parse(event.data).message);
        heading_ids[i].style.color = JSON.parse(event.data).message;
      }

      // A connection could not be made
      sockets[i].onerror = function(event) {
        console.log(event);
      }

      // A connection was closed
      sockets[i].onclose = function(code, reason) {
        console.log(code, reason);
      }
    }
  }

  createHeaders();
  setHeadingIds();

  </script>
</body>
</html>
